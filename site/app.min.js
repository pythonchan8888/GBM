class FilterManager{constructor(e){this.filters=e}applyFilters(e,t="games"){return e.filter(e=>this.matchesDateRange(e,this.filters.dateRange,t)).filter(e=>this.matchesLeague(e,this.filters.league)).filter(e=>this.matchesMinEV(e,this.filters.minEV,t)).filter(e=>this.matchesConfidence(e,this.filters.confidence))}matchesDateRange(e,t,a="games"){var i;return"all"===t||(i=new Date,!!(e=e.datetime)&&(t=parseInt(t),e=(e.getTime()-i.getTime())/864e5,"recommendations"===a?(0,-30/1440<=e&&e<=t):Math.abs(e)<=t))}matchesLeague(e,t){return"all"===t||e.league===t}matchesMinEV(e,t,a="games"){return"recommendations"===a?null!=e.ev&&t<=100*e.ev:!e.hasRecommendation||null==e.ev||t<=100*e.ev}matchesConfidence(e,t){return"all"===t||e.confidence===t}}class GameCard{constructor(e,t={}){this.game=e,this.options={compact:t.compact??!0,showHints:t.showHints??!0,index:t.index??0},this.isExpandable=e.hasRecommendation||e.kingsCall}render(){var e=this.formatTime(this.game.datetime),{homeChip:t,awayChip:a,homeTeamClass:i,awayTeamClass:s}=this.renderAhChips(),n=(this.renderHint(),this.game.ev?(100*this.game.ev).toFixed(1):0),r=.15<this.game.ev?"high":"";return`
            <div class="game-card game-card--v4" 
                 data-game-id="${this.game.datetime.getTime()}"
                 data-expandable="${this.isExpandable}"
                 data-expanded="false">
                
                <div class="game-row">
                    <div class="game-time">${e}</div>
                    <div class="game-matchup-inline">
                        <span class="team-home ${i}">
                            <i data-feather="shield" class="team-icon"></i>
                            ${this.game.home}
                        </span>
                        <span class="vs">vs</span>
                        <span class="team-away ${s}">
                            ${this.game.away}
                            <i data-feather="shield" class="team-icon"></i>
                        </span>
                    </div>
                    <div class="game-odds-summary">
                        ${t} / ${a}
                        <span class="ev-summary ${r}">${n}% EV</span>
                        ${this.isExpandable?'<button class="expand-btn" aria-label="Expand details" aria-expanded="false">▼</button>':""}
                    </div>
                </div>
                ${this.isExpandable?this.renderExpansion():""}
            </div>
        `}renderExpansion(){var e="High"===this.game.confidence?'<i data-feather="award"></i>':"Medium"===this.game.confidence?'<i data-feather="star"></i>':'<i data-feather="circle"></i>';return`
            <div class="expanded-details hidden">
                <div class="pick-section">
                    <div class="pick-main">
                        <strong>${this.game.recText}</strong> @ ${this.game.recOdds.toFixed(2)}
                    </div>
                    <div class="pick-meta">
                        <span class="ev-badge">EV ${(100*this.game.ev).toFixed(1)}%</span>
                        <span class="confidence-icon" title="${this.game.confidence}">${e}</span>
                    </div>
                </div>
                
                ${this.game.kingsCall?`
                    <button class="analysis-toggle" onclick="window.parlayKing.toggleAnalysis(this)" aria-expanded="false">
                        Show Analysis ▼
                    </button>
                    <div class="analysis-content hidden">
                        <p class="analysis-text">${this.game.kingsCall}</p>
                    </div>
                `:""}
            </div>
        `}renderAhChips(){var e,t,a,i,s;return this.game.hasAhData?(e=e=>{var t;return 0===e?"0.0":(t=Math.abs(e)%.5==0?1:2,t=e.toFixed(t),0<e?"+"+t:(""+t).replace("-","−"))},t=this.game.hasRecommendation&&this.game.recommendedTeam===this.game.home,a=this.game.hasRecommendation&&this.game.recommendedTeam===this.game.away,i=this.game.homeLine<0,s=this.game.awayLine<0,t=["ah-chip",this.game.homeLine<0?"ah-chip--neg":0<this.game.homeLine?"ah-chip--pos":"ah-chip--pk",t?"ah-chip--selected":""].filter(Boolean).join(" "),a=["ah-chip",this.game.awayLine<0?"ah-chip--neg":0<this.game.awayLine?"ah-chip--pos":"ah-chip--pk",a?"ah-chip--selected":""].filter(Boolean).join(" "),i=i?"team-name team-favorite":"team-name team-underdog",s=s?"team-name team-favorite":"team-name team-underdog",{homeChip:`<span class="${t}">${e(this.game.homeLine)}</span>`,awayChip:`<span class="${a}">${e(this.game.awayLine)}</span>`,homeTeamClass:i,awayTeamClass:s}):{homeChip:'<span class="ah-chip ah-chip--empty">—</span>',awayChip:'<span class="ah-chip ah-chip--empty">—</span>'}}renderHint(){var e;return this.game.hasRecommendation&&0<this.game.ev?(e=(100*this.game.ev).toFixed(1),`<span class="game-hint ${.15<this.game.ev?"game-hint--high-ev":"game-hint--active"}" title="Positive EV Pick: ${e}%"><i data-feather="zap"></i></span>`):""}formatTime(e){return e?e.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",hour12:!1}):"--:--"}}class DayNavigator{constructor(e){this.parlayKing=e}getDaysWithGames(){var t=new Date,a=(t.setHours(0,0,0,0),[]);for(let e=0;e<7;e++){var i=new Date(t);i.setDate(t.getDate()+e),a.push(i)}return a}setupSwipeGestures(e){let a=0,i;e.addEventListener("touchstart",e=>{a=e.changedTouches[0].screenX},{passive:!0}),e.addEventListener("touchend",e=>{i=e.changedTouches[0].screenX;var t,e=a-i;50<Math.abs(e)&&(t=parseInt(this.parlayKing.uiState.currentDay)||0,t=Math.max(0,Math.min(6,t+(0<e?1:-1))),this.parlayKing.switchDay(t.toString()))},{passive:!0})}render(){var e=this.getDaysWithGames();return 0===e.length?'<div class="day-navigator"><div class="no-upcoming-games">No upcoming games</div></div>':((parseInt(this.parlayKing.uiState.currentDay)||0)>=e.length&&(this.parlayKing.uiState.currentDay="0"),(new Date).setHours(0,0,0,0),`
            <div class="day-navigator">
                ${e.map((e,t)=>{var a=new Date,i=(a.setHours(0,0,0,0),new Date(a));i.setDate(a.getDate()+1);let s;return e.getTime()===a.getTime()?(s="Today",`
                            <button class="day-tab today ${this.parlayKing.uiState.currentDay===t.toString()?"active":""}" 
                                    data-day="${t}" onclick="window.parlayKing.switchDay('${t}')">
                                ${s}
                            </button>
                        `):(s=e.getTime()===i.getTime()?"Tomorrow":e.toLocaleDateString("en-US",{weekday:"short"})+` ${e.getDate()} `+e.toLocaleDateString("en-US",{month:"short"}),`
                        <button class="day-tab ${this.parlayKing.uiState.currentDay===t.toString()?"active":""}" 
                                data-day="${t}" onclick="window.parlayKing.switchDay('${t}')">
                            ${s}
                        </button>
                    `)}).join("")}
            </div>
        `)}}class ParlayKing{constructor(){this.cache=new Map,this.data={metrics:{},pnlByMonth:[],bankrollSeries:[],recommendations:[],roiHeatmap:[],topSegments:[],settledBets:[],parlayWins:[],unifiedGames:null},this.uiState={viewMode:window.innerWidth<=768?"mobile":"desktop",expandedCards:new Set,activeFilters:this.getFiltersFromURL(),currentDay:"0",filtersDrawerOpen:!1,renderedGames:20,virtualScrollOffset:0},this.renderQueue=[],this.isRendering=!1,this.cardInstances=new Map,this.dayNavigator=new DayNavigator(this),this.filterManager=new FilterManager(this.uiState.activeFilters),this.parlayPage=0,this.version=window.__PK_VERSION||"latest",this.init()}async init(){if(this.showLoading(!0),"serviceWorker"in navigator)try{await navigator.serviceWorker.register("/sw.js"),console.log("Service Worker registered successfully")}catch(e){console.log("Service Worker registration failed:",e)}await this.loadAllData(),this.initializeUI(),this.updateUI(),this.showLoading(!1)}async loadCSV(t,e=!0){window.Papa||await new Promise(e=>{var t=document.createElement("script");t.src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js",t.onload=e,document.head.appendChild(t)});var a="csv_"+t;if(e&&this.cache.has(a))return this.cache.get(a);try{var i,s,n=await fetch(t+"?t="+Date.now());if(n.ok)return i=await n.text(),s=Papa.parse(i,{header:!0,dynamicTyping:!0,skipEmptyLines:!0}).data,this.cache.set(a,s),s;throw new Error(`Failed to load ${t}: `+n.status)}catch(e){return console.warn(`Failed to load ${t}:`,e),this.cache.get(a)||[]}}async loadAllData(){try{var[e,t,a,i,s,n]=await Promise.all([this.loadCSV("metrics.csv").catch(()=>[]),this.loadCSV("latest_recommendations.csv").catch(()=>[]),this.loadCSV("unified_games.csv").catch(()=>[]),this.loadCSV("roi_heatmap.csv").catch(()=>[]),this.loadCSV("top_segments.csv").catch(()=>[]),this.loadCSV("parlay_wins.csv").catch(()=>[])]);this.data={...this.data,metrics:this.parseMetrics(e||[]),recommendations:this.parseRecommendations(t||[]),unifiedGames:this.parseUnifiedGames(a||[]),roiHeatmap:this.parseRoiHeatmap(i||[]),topSegments:this.parseTopSegments(s||[]),parlayWins:this.parseParlayWins(n||[])},this.populateFilterOptions(),console.log("Data loaded successfully:",{metrics:Object.keys(this.data.metrics).length,recommendations:this.data.recommendations.length,unifiedGames:this.data.unifiedGames.length,roiHeatmap:this.data.roiHeatmap.length,topSegments:this.data.topSegments.length,parlayWins:this.data.parlayWins.length})}catch(e){console.error("Failed to load data:",e),this.showError("Failed to load dashboard data. Please try refreshing the page.")}}parseMetrics(e){let t={};return Array.isArray(e)&&e.forEach(e=>{e&&e.metric&&null!==e.value&&(t[e.metric]=e.value)}),t}parseRecommendations(e){return Array.isArray(e)?e.filter(e=>e&&e.dt_gmt8&&e.home&&e.away).map(e=>({datetime:this.parseGmt8(e.dt_gmt8),league:e.league||"",home:e.home,away:e.away,recommendation:e.rec_text||"",line:parseFloat(e.line)||0,odds:parseFloat(e.odds)||0,ev:parseFloat(e.ev)||0,confidence:e.confidence||"Medium",kingsCall:e.kings_call_insight||""})).filter(e=>e.datetime).sort((e,t)=>e.datetime-t.datetime):[]}parseUnifiedGames(e){return Array.isArray(e)&&0!==e.length?e.filter(e=>e&&e.datetime_gmt8&&e.home_name&&e.away_name).map(e=>{var t=this.parseGmt8(e.datetime_gmt8);return t?(t={datetime:t,league:e.league||"",leagueShort:e.league_short||e.league||"",leagueFlag:e.league_flag||"⚽",home:e.home_name,away:e.away_name,odds1:parseFloat(e.odds_1)||0,oddsX:parseFloat(e.odds_x)||0,odds2:parseFloat(e.odds_2)||0,tier:parseInt(e.league_tier)||3,hasRecommendation:"True"===e.has_recommendation,recText:e.rec_text||"",recOdds:parseFloat(e.rec_odds)||0,ev:parseFloat(e.ev)||0,confidence:e.confidence||"",kingsCall:e.kings_call||"",primarySignal:e.primary_signal||"",ah_line_home:e.ah_line_home,ah_line_away:e.ah_line_away,ah_odds_home:e.ah_odds_home,ah_odds_away:e.ah_odds_away},e=this.parseAsianHandicapData(t),{...t,...e}):null}).filter(Boolean).sort((e,t)=>e.datetime-t.datetime):[]}parseAsianHandicapData(e){let t=null,a=null,i=null;var s,n;return null!=e.ah_line_home&&(t=parseFloat(e.ah_line_home)),null!=e.ah_line_away&&(a=parseFloat(e.ah_line_away)),(null===t||null===a)&&e.hasRecommendation&&e.recText&&(n=e.recText.match(/^(.+?)\s+([-+]?\d*\.?\d+)$/))&&(s=n[1].trim(),n=parseFloat(n[2]),s===e.home||e.home.includes(s)?(i=e.home,t=n,a=-n):s!==e.away&&!e.away.includes(s)||(i=e.away,a=n,t=-n)),null===t&&(t=0),null===a&&(a=0),{recommendedTeam:i,homeLine:t,awayLine:a,isPk:0===t&&0===a,hasAhData:!0}}parseRoiHeatmap(e){return Array.isArray(e)?e.map(e=>{var t,a;return void 0===e.tier||void 0===e.line||void 0===e.roi_pct||void 0===e.n?null:(t=`Tier ${e.tier} (Line: ${e.line})`,a=parseFloat(e.roi_pct)/100,e=parseInt(e.n),{segment:t,roi:isNaN(a)?0:a,count:isNaN(e)?0:e})}).filter(e=>null!==e&&0<e.count):[]}parseTopSegments(e){return Array.isArray(e)?e.map(e=>({tier:parseInt(e.tier)||0,line:parseFloat(e.line)||0,segment:`Tier ${e.tier} | Line `+(0<e.line?"+":"")+e.line,roi:parseFloat(e.roi_pct)/100||0,count:parseInt(e.n)||0})).filter(e=>0<e.count):[]}parseParlayWins(e){return Array.isArray(e)?e.filter(e=>e&&e.date&&e.payout):[]}parseGmt8(e){if(!e)return null;try{var[t,a="00:00:00"]=String(e).split(" "),[i,s,n]=t.split("-").map(Number),[r,l,o]=a.split(":").map(Number),d=Date.UTC(i,(s||1)-1,n||1,(r||0)-8,l||0,o||0);return new Date(d)}catch(e){return null}}isSameDay(e,t){return e.toDateString()===t.toDateString()}getFiltersFromURL(){var e=new URLSearchParams(window.location.search);return{dateRange:e.get("dateRange")||"30",league:e.get("league")||"all",minEV:parseFloat(e.get("minEV"))||0,confidence:e.get("confidence")||"all"}}getCurrentPage(){var e=window.location.pathname;return e.includes("analytics.html")?"analytics":e.includes("recommendations.html")?"recommendations":"overview"}initializeUI(){this.setupEventListeners(),this.setFilterValues(),this.setupHeaderShrinking(),this.setupPullToRefresh();var e=this.getCurrentPage();console.log("Initializing UI for page: "+e),"overview"!==e&&("analytics"===e?this.initAnalyticsPage():"recommendations"===e&&this.initRecommendationsPage())}setupPullToRefresh(){let i=document.getElementById("pull-refresh-container");if(i&&window.innerWidth<=768){let t=0,a=0;i.addEventListener("touchstart",e=>{t=e.touches[0].pageY},{passive:!0}),i.addEventListener("touchmove",e=>{0<(a=e.touches[0].pageY-t)&&0===window.scrollY&&(e.preventDefault(),i.classList.add("pulling"),i.style.setProperty("--pull-distance",Math.min(a,100)+"px"))},{passive:!1}),i.addEventListener("touchend",async()=>{i.classList.remove("pulling"),80<a&&(i.classList.add("refreshing"),await this.loadAllData(),this.updateUI(),setTimeout(()=>i.classList.remove("refreshing"),1e3)),a=0})}}setupHeaderShrinking(){let a=document.querySelector(".nav-container"),i=document.querySelector(".day-navigator");if(a){let e=()=>{var e=window.scrollY,t=(50<e?a.classList.add("shrunk"):a.classList.remove("shrunk"),a.offsetHeight);document.documentElement.style.setProperty("--header-height",t+"px"),i&&(0<e?i.classList.add("sticky-active"):i.classList.remove("sticky-active"))},t=!1;e(),window.addEventListener("scroll",()=>{t||(window.requestAnimationFrame(()=>{e(),t=!1}),t=!0)},{passive:!0}),window.addEventListener("resize",e)}}setupDayNavigationListeners(){document.querySelectorAll(".day-tab").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();e=t.dataset.day;void 0!==e&&(this.uiState.currentDay=e,this.updateUI())})})}setupEventListeners(){var e=document.getElementById("date-range"),e=(e&&e.addEventListener("change",e=>{this.uiState.activeFilters.dateRange=e.target.value,this.updateUI()}),document.getElementById("league-filter"));e&&e.addEventListener("change",e=>{this.uiState.activeFilters.league=e.target.value,this.updateUI()}),this.initRecommendationsPage(),window.innerWidth<=768&&this.initFiltersDrawer()}initRecommendationsPage(){this.setDefaultFiltersForRecommendations(),this.initEvSlider(),this.setupLeagueFilter("league-filter-recs")}initAnalyticsPage(){console.log("Initializing Analytics Page..."),this.renderRoiHeatmap(),this.renderTopSegments(),this.renderParlayWins(),this.setupAnalyticsFilters()}renderRoiHeatmap(){var e,t=document.getElementById("roi-heatmap");t?this.data.roiHeatmap&&0!==this.data.roiHeatmap.length?(console.log(`Rendering ROI Heatmap with ${this.data.roiHeatmap.length} items.`),e=[...this.data.roiHeatmap].sort((e,t)=>t.roi-e.roi).map(e=>{var t=(100*e.roi).toFixed(1);let a="heat-mid";return.05<e.roi?a="heat-pos":e.roi<-.05&&(a="heat-neg"),`
                <div class="heatmap-cell ${a}">
                    <div class="heatmap-value">${t}%</div>
                    <div class="heatmap-meta">
                        <strong>${e.segment}</strong><br>
                        <small>Bets: ${e.count}</small>
                    </div>
                </div>
            `}).join(""),t.innerHTML=`<div class="heatmap-grid">${e}</div>`):t.innerHTML='<p class="empty-state">No ROI Heatmap data available.</p>':console.warn("ROI Heatmap container (roi-heatmap) not found in HTML.")}renderTopSegments(){var e,t=document.getElementById("top-segments-container");t?this.data.topSegments&&0!==this.data.topSegments.length?(console.log(`Rendering Top Segments with ${this.data.topSegments.length} items.`),e=[...this.data.topSegments].sort((e,t)=>t.roi-e.roi).slice(0,10).map(e=>{var t=(100*e.roi).toFixed(1),a=0<e.line?"+"+e.line:""+e.line;return`
                <div class="segment-pill">
                    <div class="pill-top">
                        <span class="line-text">${t}% ROI</span>
                        <span class="segment-name">${e.segment}</span>
                    </div>
                    <div class="pill-bottom">
                        <span>Line: ${a}</span>
                        <span>Bets: ${e.count}</span>
                    </div>
                </div>
            `}).join(""),t.innerHTML=`<div class="segments-pills">${e}</div>`):t.innerHTML='<p class="empty-state">No Top Segments data available.</p>':console.log("Top segments container not found, skipping...")}renderParlayWins(){var e,t,a=document.getElementById("parlay-grid");a&&(this.data.parlayWins&&0!==this.data.parlayWins.length?(console.log(`Rendering Parlay Wins with ${this.data.parlayWins.length} items.`),e=document.getElementById("total-parlays"),t=document.getElementById("max-payout"),e&&(e.textContent=this.data.parlayWins.length),e=Math.max(...this.data.parlayWins.map(e=>parseFloat(e.payout)||0)),t&&(t.textContent="$"+e.toFixed(0)),t=this.data.parlayWins.map(e=>`
            <div class="parlay-item">
                <div class="parlay-date">${e.date}</div>
                <div class="parlay-payout">$${parseFloat(e.payout).toFixed(0)}</div>
                <div class="parlay-details">${e.details||"Multi-leg parlay win"}</div>
            </div>
        `).join(""),a.innerHTML=t):a.innerHTML='<p class="empty-state">No parlay wins data available.</p>')}setupAnalyticsFilters(){var e=document.getElementById("date-range-analytics");e&&e.addEventListener("change",e=>{this.uiState.activeFilters.dateRange=e.target.value,console.log("Analytics Date Range changed (Note: Dynamic filtering may not be fully supported yet).")})}setDefaultFiltersForRecommendations(){this.uiState.activeFilters.dateRange="7",this.uiState.activeFilters.confidence="all"}setupLeagueFilter(e){var t=document.getElementById(e);t&&(this.populateLeagueOptions(e),t.addEventListener("change",e=>{this.uiState.activeFilters.league=e.target.value,this.updateUI()}))}populateLeagueOptions(e){let a=document.getElementById(e);if(a&&this.data.recommendations){for(var t=[...new Set(this.data.recommendations.map(e=>e.league))].filter(Boolean).sort();1<a.children.length;)a.removeChild(a.lastChild);t.forEach(e=>{var t=document.createElement("option");t.value=e,t.textContent=e,a.appendChild(t)}),console.log(`Populated ${t.length} leagues in ${e}:`,t)}}initEvSlider(){let i=document.getElementById("min-ev-slider"),s=document.getElementById("min-ev-value"),n=document.querySelectorAll(".slider-labels .slider-label");if(i&&s){let t=e=>{let a=parseFloat(e);var t=a.toFixed(0),e=(i.value=e,s.textContent=t+"%",(this.uiState.activeFilters.minEV=a)/50*100);i.style.setProperty("--slider-progress",e+"%"),n.forEach(e=>{var t=parseFloat(e.dataset.value);e.classList.toggle("active",t<=a)})},a=()=>{this.updateUI()};var e=this.uiState.activeFilters.minEV||0;t(e),i.addEventListener("input",e=>{t(e.target.value)}),i.addEventListener("change",a),n.forEach(e=>{e.addEventListener("click",()=>{t(e.dataset.value),a()})})}}initFiltersDrawer(){var e=document.getElementById("filters-drawer-btn"),t=document.getElementById("filters-drawer");e&&t&&(e.addEventListener("click",()=>this.openFiltersDrawer()),(t=document.getElementById("filters-drawer-close"))&&t.addEventListener("click",()=>this.closeFiltersDrawer()),e=document.getElementById("filters-drawer-overlay"))&&e.addEventListener("click",()=>this.closeFiltersDrawer())}openFiltersDrawer(){var e=document.getElementById("filters-drawer");e&&(e.classList.add("open"),this.uiState.filtersDrawerOpen=!0,document.body.style.overflow="hidden")}closeFiltersDrawer(){var e=document.getElementById("filters-drawer");e&&(e.classList.remove("open"),this.uiState.filtersDrawerOpen=!1,document.body.style.overflow="")}setFilterValues(){var e=document.getElementById("date-range"),e=(e&&(e.value=this.uiState.activeFilters.dateRange),document.getElementById("league-filter"));e&&(e.value=this.uiState.activeFilters.league)}populateFilterOptions(){var e=[...new Set(this.data.recommendations.map(e=>e.league))].filter(Boolean).sort();let a=document.getElementById("league-filter");if(a){for(;1<a.children.length;)a.removeChild(a.lastChild);e.forEach(e=>{var t=document.createElement("option");t.value=e,t.textContent=e,a.appendChild(t)})}}updateUI(){this.updateKPIs(),this.renderUnifiedSchedule(),this.renderRecommendations(),this.updateLastRunStatus(),this.populateFilterOptions(),this.populateLeagueOptions("league-filter-recs"),setTimeout(()=>{"undefined"!=typeof feather&&feather.replace()},100)}updateKPIs(){try{var e=document.getElementById("win-rate"),t=(e&&(e.textContent=64.91.toFixed(1)+"%"),document.getElementById("roi-performance")),a=(t&&(t.textContent=`+${23.81.toFixed(1)}%`),document.getElementById("non-losing-rate")),i=(a&&(a.textContent=68.15.toFixed(1)+"%"),document.getElementById("total-bets"));i&&(i.textContent=this.data.recommendations?.length||0)}catch(e){console.warn("Error updating KPIs:",e)}}renderUnifiedSchedule(){try{var e,t,a,i,s=document.getElementById("unified-games-container");s?(this.data.unifiedGames&&0!==this.data.unifiedGames.length||(s.innerHTML=Array(5).fill('<div class="game-card skeleton"></div>').join("")),this.ensureValidCurrentDay(),(e=document.getElementById("day-navigator-container"))&&!e.querySelector(".day-navigator")&&(t=this.dayNavigator.render(),e.innerHTML=t,this.setupDayNavigationListeners(),this.centerActiveDayTab()),this.data.unifiedGames&&0!==this.data.unifiedGames.length?0===(a=this.getFilteredGamesByDay()).length?s.innerHTML='<div class="no-games">No games found for the selected day.</div>':(i=this.groupGamesByLeague(a),s.innerHTML=this.renderLeagueGroups(i),this.initGameCardInteractions()):s.innerHTML='<div class="no-games">No games available.</div>'):console.warn("Unified games container not found")}catch(e){console.error("Error rendering schedule:",e)}}ensureValidCurrentDay(){var e=this.dayNavigator.getDaysWithGames();((parseInt(this.uiState.currentDay)||0)>=e.length||0===e.length)&&(this.uiState.currentDay="0")}renderRecommendations(){try{var e,t=document.getElementById("recommendations-cards");t&&(this.data.recommendations&&0!==this.data.recommendations.length?0===(e=this.filterManager.applyFilters(this.data.recommendations,"recommendations")).length?t.innerHTML='<div class="no-recommendations">No recommendations match your filters.</div>':t.innerHTML=e.map(e=>this.renderRecommendationCard(e)).join(""):t.innerHTML='<div class="no-recommendations">No recommendations available.</div>')}catch(e){console.error("Error rendering recommendations:",e)}}renderRecommendationCard(e){var t=e.datetime?e.datetime.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",hour12:!1}):"--:--",a=e.ev?`+${(100*e.ev).toFixed(1)}%`:"--",i="High"===e.confidence?'<i data-feather="award"></i>':"Medium"===e.confidence?'<i data-feather="star"></i>':'<i data-feather="circle"></i>',s=["rec-card"];return e.ev&&.15<e.ev&&s.push("high-ev"),`
            <div class="${s.join(" ")}">
                <div class="rec-header">
                    <div class="rec-time">${t}</div>
                    <div class="rec-confidence" title="${e.confidence}">${i}</div>
                </div>
                <div class="rec-matchup">
                    <h4>${e.home} vs ${e.away}</h4>
                    <div class="rec-league">${e.league}</div>
                </div>
                <div class="rec-pick">
                    <div class="pick-text" onclick="navigator.clipboard.writeText('${e.recommendation.replace(/'/g,"\\'")}'); this.style.transform='scale(0.95)'; setTimeout(() => this.style.transform='', 150);" title="Click to copy recommendation">${e.recommendation}</div>
                </div>
                <div class="rec-footer">
                    <div class="ev-badge">EV ${a}</div>
                    ${e.kingsCall?`<button class="show-analysis-btn" onclick="this.nextElementSibling.classList.toggle('hidden')">Analysis</button>
                    <div class="analysis-content hidden">${e.kingsCall}</div>`:""}
                </div>
            </div>
        `}getFilteredGamesByDay(){var e=[...this.data.unifiedGames||[]],e=this.filterByDay(e,this.uiState.currentDay);return(e=this.filterManager.applyFilters(e,"games")).sort((e,t)=>e.datetime-t.datetime)}filterByDay(e,t){var a=this.dayNavigator.getDaysWithGames(),t=parseInt(t);if(isNaN(t)||t<0||t>=a.length)return e;let i=a[t];return e.filter(e=>this.isSameDay(e.datetime,i))}groupGamesByLeague(s){let e={};return[...new Set(s.map(e=>e.league))].sort((t,a)=>{var e,i;return"England Premier League"===t?-1:"England Premier League"===a?1:(e=s.find(e=>e.league===t)?.tier||3)!==(i=s.find(e=>e.league===a)?.tier||3)?e-i:t.localeCompare(a)}).forEach(t=>{e[t]=s.filter(e=>e.league===t).sort((e,t)=>e.datetime-t.datetime)}),e}renderLeagueGroups(e){return Object.entries(e).map(([e,t])=>this.renderTierGroup(e,t)).join("")}renderTierGroup(e,t){return`
            <div class="tier-group">
                <div class="tier-group-header">
                    <h4>${this.getLeagueFlag(e)} ${e}</h4>
                    <span class="game-count">${t.length} games</span>
                </div>
                <div class="games-list">
                    ${t.map((e,t)=>this.renderGameCard(e,t)).join("")}
                </div>
            </div>
        `}getLeagueFlag(e){return{"England Premier League":"🇬🇧","Spain La Liga":"🇪🇸","Italy Serie A":"🇮🇹","Germany Bundesliga":"🇩🇪","France Ligue 1":"🇫🇷","Netherlands Eredivisie":"🇳🇱","Portugal Primeira Liga":"🇵🇹","Belgium Pro League":"🇧🇪","Scotland Premiership":"🏴󠁧󠁢󠁳󠁣󠁴󠁿","Turkey Super Lig":"🇹🇷","Brazil Serie A":"🇧🇷","Argentina Primera Division":"🇦🇷","Mexico Liga MX":"🇲🇽","USA MLS":"🇺🇸","Japan J1 League":"🇯🇵","South Korea K League 1":"🇰🇷","Australia A-League":"🇦🇺"}[e]||"⚽"}renderGameCard(e,t){var a=new GameCard(e,{compact:"mobile"===this.uiState.viewMode,showHints:!0,index:t});return this.cardInstances.set(e.datetime.getTime()+"-"+t,a),a.render()}switchDay(t){this.uiState.currentDay=t.toString(),document.querySelectorAll(".day-tab").forEach(e=>{e.classList.toggle("active",e.dataset.day===t.toString())}),this.centerActiveDayTab();let e=document.getElementById("unified-games-container");e&&(e.style.opacity="0.5",e.style.transform="translateY(10px)",setTimeout(()=>{this.renderUnifiedSchedule(),e.style.opacity="1",e.style.transform="translateY(0)"},150))}centerActiveDayTab(){let e=document.querySelector(".day-tab.active");e&&window.innerWidth<=768&&setTimeout(()=>{e.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})},100)}toggleAnalysis(e){var t=e.nextElementSibling,a="true"===e.getAttribute("aria-expanded");t.classList.toggle("hidden",a),e.setAttribute("aria-expanded",!a),e.innerHTML=a?"Show Analysis ▼":"Hide Analysis ▲";let i=e.closest(".expanded-details");t=e.closest(".game-card");i&&t&&"true"===t.getAttribute("data-expanded")&&i.style.maxHeight&&requestAnimationFrame(()=>{i.style.maxHeight=i.scrollHeight+"px"})}toggleGameExpansion(e){var t=e.dataset.gameId;let a=e.querySelector(".expanded-details");var i=e.querySelector(".expand-btn");a&&i&&(this.uiState.expandedCards.has(t)?(this.uiState.expandedCards.delete(t),a.style.maxHeight="0",i.textContent="▼",e.setAttribute("data-expanded","false"),i.setAttribute("aria-expanded","false"),setTimeout(()=>{a.classList.add("hidden"),a.classList.remove("fade-in"),a.style.maxHeight=""},300)):(this.uiState.expandedCards.add(t),a.classList.remove("hidden"),i.textContent="▲",e.setAttribute("data-expanded","true"),i.setAttribute("aria-expanded","true"),a.style.maxHeight="0",requestAnimationFrame(()=>{a.classList.add("fade-in"),a.style.maxHeight=a.scrollHeight+"px"})))}initGameCardInteractions(){setTimeout(()=>{document.querySelectorAll('.game-card--v3[data-expandable="true"]').forEach(t=>{var e=t.querySelector(".game-row");e&&e.addEventListener("click",e=>{e.target.closest(".ah-chip")||e.target.closest(".game-hint")||e.target.closest(".analysis-toggle")||this.toggleGameExpansion(t)}),t.addEventListener("click",e=>{e.target.closest(".ah-chip")||e.target.closest(".game-hint")||e.target.closest(".analysis-toggle")||e.target.closest(".game-row")||this.toggleGameExpansion(t)})})},100)}updateLastRunStatus(){var e=this.data.metrics.finished_at||this.data.metrics.started_at;e&&console.log("Last run: "+this.formatTimeAgo(e))}formatTimeAgo(e){var t;return e?(e=new Date(e),t=new Date,(t=Math.floor((t-e)/36e5))<1?"Just now":t<24?t+"h ago":Math.floor(t/24)+"d ago"):"--"}showLoading(e){var t=document.getElementById("loading-overlay");t&&(e?t.classList.remove("hidden"):t.classList.add("hidden"))}showError(e){console.error(e)}shareGame(t){var e=this.data.unifiedGames.find(e=>e.datetime.getTime()===t);e&&(e=e.hasRecommendation?`🎯 ${e.recText} @ ${e.recOdds.toFixed(2)} odds (EV: ${(100*e.ev).toFixed(1)}%) - ${e.home} vs `+e.away:`⚽ ${e.home} vs `+e.away,navigator.share?navigator.share({title:"ParlayKing Betting Pick",text:e,url:window.location.href}):navigator.clipboard.writeText(e))}}document.addEventListener("DOMContentLoaded",()=>{window.parlayKing=new ParlayKing}),document.addEventListener("visibilitychange",()=>{!document.hidden&&window.parlayKing&&setTimeout(()=>{window.parlayKing.loadAllData()},1e3)});